---
interface Props {
  id: number;
  date?: string;
  title: string;
  content: string;
  isLast?: boolean;
}

const { id, date, title, content, isLast = false } = Astro.props as Props;

/**
 * Formats date strings in German locale format.
 * Supports: YYYY, YYYY-MM, YYYY-MM-DD
 */
function formatDate(dateStr: string | undefined): string {
  if (!dateStr) {
    return "Heute";
  }

  const parts = dateStr.split("-");

  // YYYY format
  if (parts.length === 1) {
    return parts[0];
  }

  // YYYY-MM format
  if (parts.length === 2) {
    return `${parts[1]}.${parts[0]}`;
  }

  // YYYY-MM-DD format
  if (parts.length === 3) {
    const date = new Date(dateStr);
    if (!isNaN(date.getTime())) {
      return date.toLocaleDateString("de-DE", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
      });
    }
  }

  // Fallback: try to parse as date
  const date = new Date(dateStr);
  if (!isNaN(date.getTime())) {
    return date.toLocaleDateString("de-DE", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
    });
  }

  // Last resort: return original string
  return dateStr;
}

const formattedDate = formatDate(date);
const showConnector = !isLast;
---

<article id={`entry-${id}`} class="group relative pl-10">
  <span
    class="absolute left-4 top-5 inline-flex h-3.5 w-3.5 -translate-x-1/2 items-center justify-center rounded-full border border-indigo-500/50 bg-white text-indigo-600 shadow-lg shadow-indigo-500/20 dark:border-indigo-400/60 dark:bg-slate-950 dark:text-indigo-200"
    aria-hidden="true"></span>
  {
    showConnector && (
      <span
        class="absolute left-4 top-8 bottom-0 w-px -translate-x-1/2 bg-linear-to-b from-slate-900/20 via-slate-900/10 to-transparent dark:from-white/20 dark:via-white/5"
        aria-hidden="true"
      />
    )
  }

  <header
    class="flex items-center gap-4 text-xs uppercase tracking-[0.2em] text-indigo-600 dark:text-indigo-200"
  >
    <time
      datetime={date}
      class="text-sm font-semibold tracking-[0.3em] text-indigo-600 dark:text-indigo-100"
    >
      {formattedDate}
    </time>
    <div
      class="h-px flex-1 bg-linear-to-r from-indigo-600/40 via-slate-900/20 to-transparent dark:from-indigo-400/40 dark:via-white/20"
    >
    </div>
  </header>

  <div
    class="mt-4 rounded-3xl border border-slate-900/10 bg-white px-5 py-5 text-gray-700 shadow-lg shadow-indigo-200/20 transition duration-300 group-hover:border-indigo-500/20 group-hover:shadow-indigo-500/30 dark:border-white/5 dark:bg-white/5 dark:text-gray-200 dark:shadow-indigo-500/10 dark:group-hover:border-white/10 dark:group-hover:shadow-indigo-500/20 sm:px-6 sm:py-6"
  >
    <h3 class="text-xl font-semibold text-gray-900 dark:text-white sm:text-2xl">
      {title}
    </h3>
    <p class="mt-3 text-base leading-7 text-gray-600 dark:text-gray-300">
      {content}
    </p>
  </div>
</article>
